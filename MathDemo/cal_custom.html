<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸å­¸é¡Œè§£ç¯„ä¾‹</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        .question {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 18px;
            line-height: 1.6;
        }
        .hint {
            background-color: #fff9e6;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 16px;
            color: #666;
        }
        .chart-container {
            margin: 30px 0;
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        .bar {
            margin: 15px 0;
        }
        .bar-label {
            font-size: 16px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .bar-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bar-fill {
            height: 40px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            transition: width 0.5s ease;
        }
        .bar-read {
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
        }
        .bar-unread {
            background: linear-gradient(90deg, #FF9800, #FFB74D);
        }
        .answer {
            background-color: #c8e6c9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            font-size: 20px;
            font-weight: bold;
            color: #1b5e20;
            text-align: center;
        }
    </style>
    <script>
        // URL parameter decoder
        function decodeParam(param) {
            return param ? decodeURIComponent(param) : null;
        }

        // Get all URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            
            // Numeric parameters
            let total = params.get('total');
            let perDay = params.get('perDay');
            let days = params.get('days');
            
            // Text parameters
            const question = decodeParam(params.get('question'));
            const hint = decodeParam(params.get('hint'));
            const warning = decodeParam(params.get('warning'));
            const chartTitle = decodeParam(params.get('chartTitle'));
            const readLabel = decodeParam(params.get('readLabel'));
            const unreadLabel = decodeParam(params.get('unreadLabel'));
            
            // Parse and validate numeric values
            total = total !== null ? parseInt(total) : null;
            perDay = perDay !== null ? parseInt(perDay) : null;
            days = days !== null ? parseInt(days) : null;
            
            // Validate and set defaults
            const validatedParams = {
                total: (total !== null && !isNaN(total) && total > 0) ? total : 100,
                perDay: (perDay !== null && !isNaN(perDay) && perDay >= 0) ? perDay : 30,
                days: (days !== null && !isNaN(days) && days >= 0) ? days : 4,
                question: question,
                hint: hint,
                warning: warning,
                chartTitle: chartTitle || 'ğŸ“Š é–±è®€é€²åº¦åœ–',
                readLabel: readLabel || 'å·²é–±è®€',
                unreadLabel: unreadLabel || 'æœªé–±è®€'
            };
            
            // Check for validation errors
            const errors = [];
            if (params.get('total') !== null && (isNaN(parseInt(params.get('total'))) || parseInt(params.get('total')) <= 0)) {
                errors.push('total (å¿…é ˆæ˜¯æ­£æ•´æ•¸)');
            }
            if (params.get('perDay') !== null && (isNaN(parseInt(params.get('perDay'))) || parseInt(params.get('perDay')) < 0)) {
                errors.push('perDay (å¿…é ˆæ˜¯éè² æ•´æ•¸)');
            }
            if (params.get('days') !== null && (isNaN(parseInt(params.get('days'))) || parseInt(params.get('days')) < 0)) {
                errors.push('days (å¿…é ˆæ˜¯éè² æ•´æ•¸)');
            }
            
            return {
                ...validatedParams,
                errors: errors
            };
        }

        // Update the page content
        function updateContent() {
            const { total, perDay, days, question, hint, warning, chartTitle, readLabel, unreadLabel, errors } = getUrlParams();
            
            // Calculate values
            const read = perDay * days;
            const actualRead = Math.min(read, total);
            const actualUnread = total - actualRead;
            
            // Calculate percentages
            const readPercent = total > 0 ? (actualRead / total * 100).toFixed(1) : 0;
            const unreadPercent = total > 0 ? (actualUnread / total * 100).toFixed(1) : 0;
            
            // Build messages
            let errorMessage = '';
            if (errors.length > 0) {
                errorMessage = `<div style="background-color: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #c62828;">
                    âš ï¸ <strong>åƒæ•¸éŒ¯èª¤ï¼š</strong>${errors.join(', ')} å·²ä½¿ç”¨é è¨­å€¼
                </div>`;
            }
            
            // Custom warning or auto-generate
            let warningMessage = '';
            if (warning) {
                warningMessage = `<div style="background-color: #fff3e0; color: #e65100; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
                    ${warning}
                </div>`;
            } else if (read > total) {
                warningMessage = `<div style="background-color: #fff3e0; color: #e65100; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
                    âš ï¸ <strong>æ³¨æ„ï¼š</strong>é–±è®€é æ•¸ (${read} é ) è¶…éç¸½é æ•¸ (${total} é )ï¼Œæ›¸æœ¬å·²å…¨éƒ¨è®€å®Œ
                </div>`;
            }
            
            // Info messages for edge cases
            let infoMessage = '';
            if (days === 0) {
                infoMessage = `<div style="background-color: #e3f2fd; color: #1565c0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                    â„¹ï¸ <strong>æç¤ºï¼š</strong>0 å¤©è¡¨ç¤ºå°šæœªé–‹å§‹é–±è®€
                </div>`;
            } else if (perDay === 0) {
                infoMessage = `<div style="background-color: #e3f2fd; color: #1565c0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                    â„¹ï¸ <strong>æç¤ºï¼š</strong>æ¯å¤©é–±è®€ 0 é ï¼Œè¡¨ç¤ºæ²’æœ‰é€²è¡Œé–±è®€
                </div>`;
            }
            
            // Insert messages
            const container = document.querySelector('.container');
            const h1 = container.querySelector('h1');
            
            const oldMessages = container.querySelectorAll('.dynamic-message');
            oldMessages.forEach(msg => msg.remove());
            
            if (errorMessage || warningMessage || infoMessage) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'dynamic-message';
                messageDiv.innerHTML = errorMessage + warningMessage + infoMessage;
                h1.insertAdjacentElement('afterend', messageDiv);
            }
            
            // Update question text (custom or default)
            const questionText = question || `ä¸€æœ¬æ›¸æœ‰ ${total} é ã€‚é™³å…ˆç”Ÿæ¯å¤©é–±è®€ ${perDay} é ï¼Œ${days} å¤©å¾Œï¼Œé‚„æœ‰å¤šå°‘é æ˜¯æœªé–±è®€çš„ï¼Ÿ`;
            document.getElementById('question-text').innerHTML = `<strong>é¡Œç›®ï¼š</strong><br>${questionText}`;
            
            // Update hint text (custom or default)
            const hintText = hint || `å…ˆç®—å‡º ${days} å¤©ç¸½å…±è®€äº†å¤šå°‘é ï¼ˆ${perDay} Ã— ${days} = ${read}ï¼‰ï¼Œå†ç”¨ç¸½é æ•¸æ¸›å»å·²è®€é æ•¸`;
            document.getElementById('hint-text').innerHTML = `ğŸ’¡ æç¤ºï¼š${hintText}`;
            
            // Update chart title
            document.getElementById('chart-title').textContent = chartTitle;
            
            // Update bar labels
            document.getElementById('read-label').textContent = readLabel;
            document.getElementById('unread-label').textContent = unreadLabel;
            
            // Update bar chart
            const readBar = document.getElementById('read-bar');
            const unreadBar = document.getElementById('unread-bar');
            
            readBar.style.width = Math.max(readPercent, 0) + '%';
            readBar.style.minWidth = actualRead > 0 ? '60px' : '0';
            readBar.textContent = actualRead + ' é ';
            
            unreadBar.style.width = Math.max(unreadPercent, 0) + '%';
            unreadBar.style.minWidth = actualUnread > 0 ? '60px' : '0';
            unreadBar.textContent = actualUnread + ' é ';
            
            // Fade bars with zero values
            if (actualRead === 0) {
                readBar.parentElement.parentElement.style.opacity = '0.5';
            } else {
                readBar.parentElement.parentElement.style.opacity = '1';
            }
            
            if (actualUnread === 0) {
                unreadBar.parentElement.parentElement.style.opacity = '0.5';
            } else {
                unreadBar.parentElement.parentElement.style.opacity = '1';
            }
        }

        // Run when page loads
        window.addEventListener('DOMContentLoaded', updateContent);
    </script>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š æ•¸å­¸é¡Œè§£ç¯„ä¾‹ - è‡ªè¨‚ç‰ˆ</h1>
        
        <div class="question" id="question-text">
            <strong>é¡Œç›®ï¼š</strong><br>
            ä¸€æœ¬æ›¸æœ‰ 100 é ã€‚é™³å…ˆç”Ÿæ¯å¤©é–±è®€ 30 é ï¼Œ4 å¤©å¾Œï¼Œé‚„æœ‰å¤šå°‘é æ˜¯æœªé–±è®€çš„ï¼Ÿ
        </div>

        <div class="hint" id="hint-text">
            ğŸ’¡ æç¤ºï¼šå…ˆç®—å‡º 4 å¤©ç¸½å…±è®€äº†å¤šå°‘é ï¼ˆ30 Ã— 4 = 120ï¼‰ï¼Œå†ç”¨ç¸½é æ•¸æ¸›å»å·²è®€é æ•¸
        </div>

        <div class="chart-container">
            <div class="chart-title" id="chart-title">ğŸ“Š é–±è®€é€²åº¦åœ–</div>
            
            <div class="bar">
                <div class="bar-label" id="read-label">å·²é–±è®€</div>
                <div class="bar-wrapper">
                    <div class="bar-fill bar-read" id="read-bar" style="width: 100%;">
                        100 é 
                    </div>
                </div>
            </div>

            <div class="bar">
                <div class="bar-label" id="unread-label">æœªé–±è®€</div>
                <div class="bar-wrapper">
                    <div class="bar-fill bar-unread" id="unread-bar" style="width: 0%;">
                        0 é 
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
